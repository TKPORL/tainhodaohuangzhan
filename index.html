<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tsinho导航站</title>
    <style>
        :root{ 
            --bg:#F2F2F7; 
            --card:#FFFFFF; 
            --glass: rgba(255,255,255,0.82); 
            --radius-lg:16px; 
            --radius-md:12px; 
            --shadow: 0 6px 18px rgba(16,24,40,0.06); 
            --accent:#0A84FF; 
            --muted:#6B7280; 
            --text:#111827; 
        } 
        *{box-sizing:border-box; margin:0; padding:0;} 
        html,body{height:100%; background:var(--bg);} 
        body{ 
            font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; 
            color:var(--text); 
            -webkit-font-smoothing:antialiased; 
            -moz-osx-font-smoothing:grayscale; 
            padding:16px; 
        } 
        
        /* 布局容器：响应式布局 */
        .app-container {
            max-width: 1200px; /* 电脑端放宽限制 */
            margin: 0 auto;   /* 居中显示 */
            width: 100%;
            padding: 0 16px;  /* 增加边距 */
        }

        /* 头部容器 */
        .header-container {
            background:var(--glass);
            backdrop-filter: blur(14px) saturate(1.2);
            box-shadow:var(--shadow);
            border-radius:var(--radius-lg);
            padding:20px;
            margin-bottom:16px;
            text-align:center;
            /* 宽度跟随父容器 */
            width: 100%;
        }
        .app-title{
            font-size:24px;
            font-weight:700;
            margin-bottom:12px;
            color:var(--text);
        }
        /* Search */ 
        .search-bar{ 
            display:flex;
            align-items:center;
            gap:8px;
            padding:10px 16px;
            border-radius:999px;
            background:rgba(248,250,252,0.95);
            box-shadow:0 2px 6px rgba(0,0,0,0.04);
            width: 100%; /* 占满容器 */
            max-width: 600px; /* 电脑端搜索框不需要太宽 */
            margin:0 auto;
        } 
        .search-input{
            border:none;
            background:transparent;
            outline:none;
            font-size:14px;
            color:inherit;
            flex:1;
            min-width:0;
        }
        /* Content */ 
        .content{
            display:flex;
            flex-direction:column;
            gap:14px;
            min-height:60vh;
            width: 100%; /* 占满容器 */
        } 
        .section-card{ 
            border-radius:var(--radius-lg); 
            padding:16px; 
            background:var(--glass); 
            backdrop-filter: blur(18px) saturate(1.2); 
            box-shadow:var(--shadow); 
        } 
        .section-header{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:8px;
            margin-bottom:12px;
        } 
        .section-title{
            font-size:16px;
            font-weight:600;
            display:flex;
            align-items:center;
            gap:8px;
        } 
        .section-hint{
            font-size:12px;
            color:var(--muted);
        } 
        /* 网格布局 */
        .sites-grid{ 
            display:grid; 
            gap:16px; /* 增加间距 */
            /* 电脑端自适应，每个卡片最小 220px */
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        } 
        .site-item{ 
            display:flex;
            flex-direction: row;
            align-items: center; /* 垂直居中 */
            text-align: left;
            gap:10px;
            padding:12px;
            border-radius:12px;
            background:var(--card);
            cursor:pointer;
            box-shadow:0 2px 6px rgba(0,0,0,0.04); 
            transition:transform .16s ease,box-shadow .16s ease;
            width:100%;
            min-height:80px;
        } 
        .site-item:hover{
            transform:translateY(-4px);
            box-shadow:0 8px 20px rgba(16,24,40,0.08);
        } 
        .site-icon{
            width:44px; /* 稍微加大图标 */
            height:44px;
            border-radius:10px;
            background:linear-gradient(135deg,rgba(10,132,255,0.08),rgba(16,185,129,0.06));
            display:inline-flex;
            align-items:center;
            justify-content:center;
            font-weight:700;
            color:var(--accent);
            flex-shrink:0;
            font-size: 18px;
            margin-top:0; /* 取消 top margin，使用 align-items: center */
        } 
        .site-meta{
            min-width:0;
            flex:1;
        } 
        .site-name{
            font-size:15px; /* 字体微调 */
            font-weight:600;
            white-space:nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
            margin-bottom:4px;
        } 
        .site-tags{
            margin-top:4px;
            display:flex;
            gap:4px;
            flex-wrap:wrap;
        } 
        .tag{
            font-size:10px;
            padding:2px 6px;
            border-radius:999px;
            background:rgba(148,163,184,0.12);
            color:#374151;
            white-space:nowrap;
        } 
        
        /* 手机端适配 (小于 768px) */
        @media (max-width:768px){
            .app-container {
                max-width: 100%;
                padding: 0 12px;
            }
            
            .sites-grid {
                gap: 10px;
                /* 强制一行两个 */
                grid-template-columns: repeat(2, 1fr); 
            }
            
            .site-item {
                padding: 10px;
                flex-direction: column; /* 图标在上，文字在下 */
                text-align: center;
                align-items: center;
                justify-content: center;
                min-height: 100px;
            }
            
            .site-icon {
                width: 36px;
                height: 36px;
                font-size: 14px;
                margin-bottom: 4px;
            }
            
            .site-meta {
                width: 100%;
            }
            
            .site-name {
                font-size: 13px;
                margin-bottom: 2px;
            }
            
            .site-tags {
                justify-content: center; /* 标签居中 */
            }
        }
    </style>
</head>
<body>
    <!-- 增加一个包裹层来限制宽度 -->
    <div class="app-container">
        <div class="header-container">
            <div class="app-title">Tsinho导航站</div>
            <div class="search-bar">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 21L16.65 16.65" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="搜索站点或标签...">
            </div>
        </div>

        <div id="contentArea" class="content"></div>
    </div>

    <script>
        // Storage & version
        const STORAGE_KEY = "tsinho-nav-home-v1";
        const DATA_VERSION = "2025-12-21-v7";
        
        // App state
        let state = { sections: [], sites: [] };
        
        // Default data
        function defaultData(){
            const defaultSections = [
                { id: "sec-tsinho", name: "Tsinho资源库", visible: true, order: 1 },
                { id: "sec-netdisk", name: "网盘合集", visible: true, order: 2 }
            ];
            
            const defaultSites = [
                { id: "site-1", sectionId: "sec-tsinho", name: "全资源合集", url: "https://yun.139.com/shareweb/#/w/i/2s2yiTvk1Gwfg", tags: ["破解","黄油"], visible: true, order: 1 },
                { id: "site-2", sectionId: "sec-tsinho", name: "实用软件", url: "https://yun.139.com/shareweb/#/w/i/2s2xQZqJ9TZfu", tags: ["软件","破解"], visible: true, order: 2 },
                { id: "site-3", sectionId: "sec-tsinho", name: "老司机", url: "https://yun.139.com/shareweb/#/w/i/2s2xR5raFw08w", tags: ["涩涩","绅士"], visible: true, order: 3 },
                { id: "site-4", sectionId: "sec-tsinho", name: "V2节点", url: "https://yun.139.com/shareweb/#/w/i/2s2xRbrCozatn", tags: ["节点"], visible: true, order: 4 },
                { id: "site-5", sectionId: "sec-tsinho", name: "绅士壁纸分享", url: "https://yun.139.com/shareweb/#/w/i/2s2xR8rp0ysdz", tags: ["涩图","壁纸"], visible: true, order: 5 },
                { id: "site-6", sectionId: "sec-tsinho", name: "网盘帮下目录", url: "https://yun.139.com/shareweb/#/w/i/2s2xRksiedhqv", tags: ["网盘帮下"], visible: true, order: 6 },
                { id: "site-7", sectionId: "sec-tsinho", name: "iOS签名证书", url: "https://yun.139.com/shareweb/#/w/i/2s2xR5raHuepx", tags: ["iOS","证书"], visible: true, order: 7 },
                { id: "site-8", sectionId: "sec-tsinho", name: "资源更新文档", url: "https://yun.139.com/shareweb/#/w/i/2s2xQJpAR7Vqw", tags: ["更新通知"], visible: true, order: 8 },
                { id: "site-9", sectionId: "sec-netdisk", name: "网盘工具", url: "https://yun.139.com/shareweb/#/w/i/2s2xQZqJcfUm6", tags: ["工具"], visible: true, order: 1 },
                { id: "site-10", sectionId: "sec-netdisk", name: "网盘教程", url: "https://dcnl6jstdzjw.feishu.cn/wiki/AgCBwxKSPinKYyko2qSc2SgmnMh", tags: ["教程"], visible: true, order: 2 }
            ];
            
            return { sections: defaultSections, sites: defaultSites };
        }
        
        // Load & save
        function loadData(){
            // 直接使用代码中的默认数据，不再从 localStorage 读取
            // 这样你修改代码后刷新页面就会立即生效
            const d = defaultData();
            state.sections = d.sections;
            state.sites = d.sites;
            
            // 如果你想保留“保存到本地”的功能以便将来扩展，可以保留这行，
            // 但目前读取逻辑已经改为强制读取代码配置。
            saveLocal(); 
        }
        
        function saveLocal(){
            const payload = { sections: state.sections, sites: state.sites };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        }
        
        // 桌面模式打开链接
        function openInDesktopMode(url) {
            // 检测是否为移动设备
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                // 创建中间页面，设置桌面模式viewport并重定向
                const desktopPage = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1.0, user-scalable=yes">
    <title>正在跳转...</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
            background: #F2F2F7;
        }
        .loading {
            text-align: center;
            color: #6B7280;
        }
    </style>
    <script>
        // 立即重定向到目标URL
        window.location.replace("${url.replace(/"/g, '&quot;')}");
    <\/script>
</head>
<body>
    <div class="loading">正在跳转...</div>
</body>
</html>`;
                
                // 使用blob URL创建中间页面
                const blob = new Blob([desktopPage], { type: 'text/html' });
                const blobUrl = URL.createObjectURL(blob);
                const newWindow = window.open(blobUrl, '_blank');
                
                // 清理blob URL（延迟清理以确保页面加载）
                setTimeout(() => {
                    URL.revokeObjectURL(blobUrl);
                }, 1000);
            } else {
                // 非移动设备直接打开
                window.open(url, '_blank');
            }
        }
        
        // Render
        const contentArea = document.getElementById("contentArea");
        function render(){
            contentArea.innerHTML = "";
            const q = (document.getElementById("searchInput").value || "").trim().toLowerCase();
            
            const sections = state.sections.slice().sort((a,b)=> (a.order||0)-(b.order||0));
            
            for(const sec of sections){
                if(!sec.visible) continue;
                
                const secCard = document.createElement("section");
                secCard.className = "section-card";
                
                const header = document.createElement("div");
                header.className = "section-header";
                
                const left = document.createElement("div");
                left.className = "section-title";
                left.textContent = sec.name;
                header.appendChild(left);
                
                const right = document.createElement("div");
                right.className = "section-hint";
                const count = state.sites.filter(s => s.sectionId === sec.id && s.visible).length;
                right.textContent = `${count} 个站点`;
                header.appendChild(right);
                
                secCard.appendChild(header);
                
                const grid = document.createElement("div");
                grid.className = "sites-grid";
                
                const sites = state.sites
                    .filter(s => s.sectionId === sec.id && s.visible)
                    .filter(s => {
                        if(!q) return true;
                        const inName = (s.name || "").toLowerCase().includes(q);
                        const inTags = (s.tags || []).some(t => (t||"").toLowerCase().includes(q));
                        return inName || inTags;
                    })
                    .sort((a,b)=> (a.order||0)-(b.order||0));
                
                for(const site of sites){
                    const item = document.createElement("div");
                    item.className = "site-item";
                    
                    const icon = document.createElement("div");
                    icon.className = "site-icon";
                    icon.textContent = (site.name || "S").slice(0,1).toUpperCase();
                    
                    const meta = document.createElement("div");
                    meta.className = "site-meta";
                    
                    const name = document.createElement("div");
                    name.className = "site-name";
                    name.textContent = site.name;
                    
                    const tagsWrap = document.createElement("div");
                    tagsWrap.className = "site-tags";
                    (site.tags || []).forEach(t => {
                        const tag = document.createElement("div");
                        tag.className = "tag";
                        tag.textContent = t;
                        tagsWrap.appendChild(tag);
                    });
                    
                    meta.appendChild(name);
                    meta.appendChild(tagsWrap);
                    item.appendChild(icon);
                    item.appendChild(meta);
                    
                    item.addEventListener("click", () => {
                        if(site.url) openInDesktopMode(site.url);
                    });
                    
                    grid.appendChild(item);
                }
                
                secCard.appendChild(grid);
                contentArea.appendChild(secCard);
            }
        }
        
        // Search binding
        document.getElementById("searchInput").addEventListener("input", ()=> render());
        
        // Init
        loadData();
        render();
        
        // Expose for console debugging
        window.__TSINHO = { state, saveLocal, loadData, render };
    </script>
</body>
</html>